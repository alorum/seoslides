/*! seoslides - v1.7.0
 * https://seoslides.com
 * Copyright (c) 2016 Alorum; * Licensed GPLv2+ */
!function(a,b,c){function d(b){return b=b||a.event,b&&(b.returnValue=i.confirm_navigation),i.confirm_navigation}function e(){var d=this,e=[],f={},g=0,h=0;d.add_presentation=function(a){e.push(a)},d.count_slides=function(){var a=b.Deferred(),h=b(e).map(function(a,d){return b.ajax({type:"post",url:i.ajaxurl,data:{action:"seoslides-import",presentation:d},success:function(a){c===a.not_ready&&(f[a.slideset]=a.slides,g+=a.total)}})});return b.when.apply(null,h.get()).then(function(){a.resolveWith(d,[g])}),a.promise()},d.progress=null,d.import_success=function(){h+=1;var b=a.Math.floor(h/g*100);null!==d.progress&&d.progress.progressbar({value:b})},d.do_import=function(){var g=b.Deferred(),j=[];return b.each(f,function(e,f){b.each(f,function(f,h){j.push(b.ajax({type:"post",url:i.ajaxurl,tryCount:0,retryLimit:3,data:{action:"seoslides-get-slide",slideset:e,file:h,slide:f,_nonce:i.nonce_import},error:function(d,e,f){return"timeout"===e&&++this.tryCount<=this.retryLimit?(c!==a.console&&a.console.log("Re-import: "+h),void b.ajax(this)):(c!==a.console&&a.console.log("Import failed: "+h),o.html("<p>"+i.text_failure+"</p>"),b.each(j,function(a,b){b.abort()}),void g.rejectWith(this))},success:d.import_success}))})}),b.when.apply(null,j).then(function(){var a=[];b.each(e,function(c,d){a.push(b.ajax({type:"post",url:i.ajaxurl,data:{action:"seoslides-import-complete",presentation:d}}))}),b.when.apply(null,a).then(function(){g.resolveWith(d,[h])})}),g.promise()}}function f(c){var e=this;e.import_queue=c,e.queue=function(){var e=b.Deferred();return a.onbeforeunload=d,n.prop("disabled",!0),k="<p>"+i.text_running+'</p><div id="import-progressbar" style="margin-bottom:20px;"><div class="progress-label"></div></div>',o.html(k),b.ajax({type:"post",url:i.ajaxurl,data:{action:"get_presentations"},success:function(a){for(var b=0,d=a.length;d>b;b++)c.add_presentation(a[b]);e.resolveWith(this,[a])}}),e.promise()}}function g(){b.ajax({type:"post",url:i.ajaxurl,data:{action:"seoslides-import-status"},success:function(b){p.progress.fadeOut("slow",function(){a.onbeforeunload=null,p=new e,q=new f(p),o.html("<p>"+b+"</p>")})}})}function h(){var a=b(j.getElementById("import-progressbar")),c=a.find(".progress-label");p.progress=a.progressbar({value:!1,change:function(){c.text(p.progress.progressbar("value")+"%")}}),p.count_slides().done(function(){p.do_import().done(g)})}var i=a.ssimport,j=a.document,k="",l=j.getElementById("seoslides_process"),m=j.getElementById("seoslides_import_status"),n=b(l),o=b(m),p=new e,q=new f(p);n.on("click",function(){q.queue().done(h)}),b(j.getElementsByClassName("wrap")).on("click",".seoslides-vistoggler",function(){b(this).find(".seoslides-vistogglee").toggle("slow")})}(this,jQuery);